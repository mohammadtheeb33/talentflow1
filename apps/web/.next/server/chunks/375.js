"use strict";exports.id=375,exports.ids=[375],exports.modules={49375:(e,t,s)=>{s.d(t,{W:()=>d});var n=s(10326),a=s(17577);function o(){return process.env.FIREBASE_EMULATORS_FUNCTIONS_PORT,["https://us-central1-cvchk-1a7e0.cloudfunctions.net"]}async function r(e,t){let s=o(),n=null;for(let a of s){let s=`${a}${e}`;try{let e=await fetch(s,t);if(e.ok)return e;n=Error(`HTTP ${e.status} on ${s}`)}catch(e){n=Error(`${e?.message||e} on ${s}`)}}throw n||Error("Failed to fetch from any functions base")}async function l(e,t,s,n){let a=new URLSearchParams({uid:encodeURIComponent(e)});a.set("action","start"),t&&a.set("scopes",t),s&&a.set("force_consent","1"),n&&a.set("tenant",n);let o=await r(`/outlookOAuth?${a.toString()}`,{method:"GET"});if(!o.ok){let e=`Failed to start OAuth (${o.status})`;try{let t=await o.json();e=t?.error||e}catch{}throw Error(e)}return await o.json()}async function i(e){let t=o(),s=`/outlookOAuth?action=status&uid=${encodeURIComponent(e)}&details=1`,n=null,a=null;for(let e of t)try{let t=await fetch(`${e}${s}`,{method:"GET"}),a=await t.json();if(a&&a.connected)return a;n=a}catch(e){a=e}if(n)return n;if(a)throw a;return{connected:!1}}async function c(e,t,s,n){let a={uid:e,from:t,to:s};n?.fileType&&(a.fileType=n.fileType),n?.folder&&(a.folder=n.folder),n?.jobProfileId&&(a.jobProfileId=n.jobProfileId);let o=await r("/fetchAttachments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!o.ok){let e=`Failed to fetch attachments (${o.status})`;try{let t=await o.json();e=t?.error||e}catch{}throw Error(e)}return await o.json()}function d({isOpen:e,onClose:t}){let[s,r]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),[h,f]=(0,a.useState)(void 0),[g,p]=(0,a.useState)(void 0),[j,b]=(0,a.useState)(""),[y,v]=(0,a.useState)(""),[N,w]=(0,a.useState)(!1),[S,C]=(0,a.useState)(null),[$,k]=(0,a.useState)([]),T=(0,a.useRef)(null),[A,O]=(0,a.useState)("pdf"),[R,E]=(0,a.useState)("inbox"),[F,I]=(0,a.useState)([]),[P,_]=(0,a.useState)(""),U=(0,a.useMemo)(()=>x&&!!j&&!!y&&!!P,[x,j,y,P]);function M(e,t){k(s=>[...s,{type:e,message:t}])}async function L(){if(s){u(!0),C(null);try{let{authUrl:e}=await l(s,"offline_access Mail.Read User.Read",!0,"consumers");M("info","Opening Microsoft sign-in window..."),T.current=window.open(e,"outlook-oauth","width=600,height=700"),setTimeout(()=>D(),2500)}catch(e){M("error",e?.message||"Failed to start OAuth");try{let e=function(e,t,s,n){let a=o()[0],r=new URLSearchParams({action:"start",uid:encodeURIComponent(e),auto:"1"});return t&&r.set("scopes",t),s&&r.set("force_consent","1"),n&&r.set("tenant",n),`${a}/outlookOAuth?${r.toString()}`}(s,"offline_access Mail.Read User.Read",!0,"consumers");M("info","Opening fallback start page..."),T.current=window.open(e,"outlook-oauth","width=600,height=700"),setTimeout(()=>D(),3e3)}catch(e){}}finally{u(!1)}}}async function D(){if(s)try{let e=await i(s);m(!!e.connected),f(e.email),p(e.displayName),e.connected?M("info","Outlook connected"):M("info","Not connected yet")}catch(e){M("error",e?.message||"Failed to check status")}}async function J(){if(!s||!j||!y)return;if(!P){M("error","يرجى اختيار ملف وظيفي أولاً ليتم الفحص بناءً عليه.");return}w(!0),C(null);let e=F.find(e=>e.id===P),t=e?e.title||e.id:P;M("info",`سيتم الفحص حسب الملف الوظيفي: ${t} (${P}).`),M("info",`Fetching ${A.toUpperCase()} from ${R} and creating documents...`);try{let e=await c(s,j,y,{fileType:A,folder:R,jobProfileId:P||void 0});C(e.createdCount),M("info",`Created ${e.createdCount} documents from attachments`);let t=e?.stats;if(t&&(t.jobProfileId||t.folder||t.fileType)){let e=t.jobProfileId?String(t.jobProfileId):P,s=t.folder?String(t.folder):R,n=t.fileType?String(t.fileType):A;M("info",`JobProfileId: ${e}, Folder: ${s}, FileType: ${n}`)}if(e?.stats){let t=e.stats;if(M("info",`Scanned ${t.scannedAttachmentsCount??0} attachments across ${t.messagesCount??0} messages.`),"number"==typeof t.attemptedCreatesCount&&M("info",`Attempted to create ${t.attemptedCreatesCount} documents.`),t.bucket&&M("info",`Storage bucket: ${t.bucket}`),t.env){let e=t.env.FIREBASE_STORAGE_EMULATOR_HOST||t.env.STORAGE_EMULATOR_HOST||"",s=t.env.FIRESTORE_EMULATOR_HOST||"";(e||s)&&M("info",`Emulators — Firestore: ${s||"n/a"}, Storage: ${e||"n/a"}`)}}if(e?.samples){let t=e.samples,s=(e,t)=>{if(!e||0===e.length)return;let s=e.slice(0,5).map(e=>`${e.name} (${e.contentType||"unknown"})`).join(", ");M("info",`${t}: ${s}`)};s(t.all,"Returned attachments (sample)"),s(t.accepted,"Accepted attachments (sample)")}if(e?.errorCount&&Array.isArray(e.errors)&&e.errors.length){let t=e.errors.slice(0,5).map(e=>`${e.stage}: ${e.message}`);M("error",`Errors (${e.errorCount}): ${t.join("; ")}`)}}catch(e){M("error",e?.message||"Failed to fetch attachments")}finally{w(!1)}}return e?n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,n.jsxs)("div",{className:"w-full max-w-xl rounded-lg border bg-white p-4 shadow-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[n.jsx("h3",{className:"text-sm font-semibold",children:"Connect Outlook"}),n.jsx("button",{onClick:t,className:"rounded px-2 py-1 text-xs hover:bg-gray-100",children:"Close"})]}),(0,n.jsxs)("div",{className:"mt-4 space-y-4 text-sm",children:[(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Authentication"}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[n.jsx("div",{className:"text-xs text-gray-600",children:"Microsoft Outlook"}),n.jsx("button",{onClick:L,disabled:d,className:"rounded-md border bg-white px-3 py-2 text-xs hover:bg-gray-50 disabled:opacity-60",children:d?"Connecting…":"Connect with Microsoft Outlook"})]}),x&&(0,n.jsxs)("div",{className:"mt-2 inline-flex items-center gap-2 rounded-md bg-green-50 px-2 py-1 text-xs text-green-700",children:[n.jsx("span",{className:"font-medium",children:"Connected"}),n.jsx("span",{children:h||g||"Account linked"})]})]}),(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Date range"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"From date"}),n.jsx("input",{type:"date",value:j,onChange:e=>b(e.target.value),className:"w-full rounded border p-2 text-xs"})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"To date"}),n.jsx("input",{type:"date",value:y,onChange:e=>v(e.target.value),className:"w-full rounded border p-2 text-xs"})]})]})]}),(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Filters"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"File type"}),(0,n.jsxs)("select",{value:A,onChange:e=>O(e.target.value),className:"w-full rounded border p-2 text-xs",children:[n.jsx("option",{value:"pdf",children:"PDF"}),n.jsx("option",{value:"doc",children:"DOC"}),n.jsx("option",{value:"docx",children:"DOCX"}),n.jsx("option",{value:"txt",children:"TXT"}),n.jsx("option",{value:"all",children:"All"})]})]}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"Folder"}),(0,n.jsxs)("select",{value:R,onChange:e=>E(e.target.value),className:"w-full rounded border p-2 text-xs",children:[n.jsx("option",{value:"inbox",children:"Inbox"}),n.jsx("option",{value:"junkemail",children:"Junk Email"}),n.jsx("option",{value:"archive",children:"Archive"}),n.jsx("option",{value:"all",children:"All folders"})]})]})]})]}),(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Job Profile"}),(0,n.jsxs)("div",{children:[n.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"Select a job profile to evaluate against"}),(0,n.jsxs)("select",{value:P,onChange:e=>_(e.target.value),className:"w-full rounded border p-2 text-xs",children:[n.jsx("option",{value:"",children:"— Select Job Profile —"}),F.map(e=>n.jsx("option",{value:e.id,children:e.title||e.id},e.id))]})]})]}),(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Actions"}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:`inline-flex items-center gap-2 rounded-md px-2 py-1 text-xs ${x?"bg-green-50 text-green-700":"bg-gray-50 text-gray-700"}`,children:[n.jsx("span",{className:"font-medium",children:x?"Connected":"Not connected"}),x&&n.jsx("span",{children:h||g||"Account"})]}),n.jsx("button",{onClick:J,disabled:!U||N,className:"rounded-md bg-indigo-600 px-3 py-2 text-xs text-white hover:bg-indigo-700 disabled:opacity-60",children:N?"Fetching…":"Fetch Attachments"})]}),null!==S&&(0,n.jsxs)("div",{className:"mt-2 text-xs text-gray-700",children:["Created ",S," documents."]})]}),(0,n.jsxs)("section",{children:[n.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"Status"}),n.jsx("div",{className:"rounded-md border bg-gray-50 p-3",children:0===$.length?n.jsx("div",{className:"text-xs text-gray-600",children:"Loading messages…"}):n.jsx("ul",{className:"space-y-1 text-xs",children:$.map((e,t)=>n.jsx("li",{className:"error"===e.type?"text-red-700":"text-gray-800",children:e.message},t))})}),(0,n.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[n.jsx("button",{onClick:t,className:"rounded-md border bg-white px-3 py-2 text-xs hover:bg-gray-50",children:"Close"}),n.jsx("button",{onClick:D,className:"rounded-md border bg-white px-3 py-2 text-xs hover:bg-gray-50",children:"Retry"}),n.jsx("button",{onClick:t,className:"rounded-md bg-indigo-600 px-3 py-2 text-xs text-white hover:bg-indigo-700",children:"Done"})]})]})]})]})}):null}s(90445),s(76)}};