(()=>{var e={};e.id=935,e.ids=[935],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},98061:e=>{"use strict";e.exports=require("node:assert")},92761:e=>{"use strict";e.exports=require("node:async_hooks")},72254:e=>{"use strict";e.exports=require("node:buffer")},40027:e=>{"use strict";e.exports=require("node:console")},6005:e=>{"use strict";e.exports=require("node:crypto")},65714:e=>{"use strict";e.exports=require("node:diagnostics_channel")},15673:e=>{"use strict";e.exports=require("node:events")},88849:e=>{"use strict";e.exports=require("node:http")},42725:e=>{"use strict";e.exports=require("node:http2")},87503:e=>{"use strict";e.exports=require("node:net")},38846:e=>{"use strict";e.exports=require("node:perf_hooks")},39630:e=>{"use strict";e.exports=require("node:querystring")},84492:e=>{"use strict";e.exports=require("node:stream")},31764:e=>{"use strict";e.exports=require("node:tls")},41041:e=>{"use strict";e.exports=require("node:url")},47261:e=>{"use strict";e.exports=require("node:util")},93746:e=>{"use strict";e.exports=require("node:util/types")},24086:e=>{"use strict";e.exports=require("node:worker_threads")},65628:e=>{"use strict";e.exports=require("node:zlib")},52338:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>l}),s(29711),s(29594),s(35866);var r=s(23191),i=s(88716),a=s(37922),o=s.n(a),n=s(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);s.d(t,c);let l=["",{children:["cvs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,29711)),"C:\\Users\\ace_d\\Documents\\trae_projects\\cvats\\apps\\web\\app\\cvs\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,29594)),"C:\\Users\\ace_d\\Documents\\trae_projects\\cvats\\apps\\web\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\ace_d\\Documents\\trae_projects\\cvats\\apps\\web\\app\\cvs\\page.tsx"],u="/cvs/page",x={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/cvs/page",pathname:"/cvs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},5825:(e,t,s)=>{Promise.resolve().then(s.bind(s,15358))},15358:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(10326),i=s(17577),a=s(54246),o=s(90445),n=s(76),c=s(11552);function l({isOpen:e,onClose:t}){let[s,a]=(0,i.useState)([]),[l,d]=(0,i.useState)(""),[u,x]=(0,i.useState)(""),[p,m]=(0,i.useState)(""),[h,g]=(0,i.useState)(!1),[f,v]=(0,i.useState)(0),[b,j]=(0,i.useState)(0),[y,q]=(0,i.useState)([]),w=(0,i.useMemo)(()=>!!l&&!!u&&!!p,[l,u,p]);function _(e,t){q(s=>[...s,{type:e,message:t}])}async function N(){if(w)try{let e=(0,o.kL)(),t=e.currentUser?.uid;if(!t){_("error","غير مصرح: الرجاء تسجيل الدخول");return}g(!0),v(0),j(0),q([]),_("info","بدء الفحص الجماعي…");let r=(0,o.X9)(),i=(0,o.bH)(),a=n.Timestamp.fromDate(new Date(`${u}T00:00:00`)),d=n.Timestamp.fromDate(new Date(`${p}T23:59:59`)),x=(0,n.query)((0,n.collection)(r,"cvs"),(0,n.where)("uid","==",t),(0,n.where)("createdAt",">=",a),(0,n.where)("createdAt","<=",d),(0,n.orderBy)("createdAt"),(0,n.limit)(500)),m=[];try{(await (0,n.getDocs)(x)).forEach(e=>m.push({id:e.id,data:e.data()}))}catch(c){if(!("string"==typeof c?.message&&c.message.toLowerCase().includes("requires an index")))throw c;_("info","الاستعلام يتطلب فهرسًا مركّبًا (uid + createdAt). تم استخدام آلية احتياطية مؤقتًا؛ يُنصح بإنشاء الفهرس المقترح.");let e=(0,n.query)((0,n.collection)(r,"cvs"),(0,n.where)("uid","==",t),(0,n.limit)(500)),s=await (0,n.getDocs)(e),i=new Map;s.forEach(e=>{let t=e.data();i.set(e.id,t)});let o=(0,n.query)((0,n.collection)(r,"cvs"),(0,n.where)("userId","==",t),(0,n.limit)(500));(await (0,n.getDocs)(o)).forEach(e=>{let t=e.data();i.set(e.id,t)}),m=Array.from(i.entries()).map(([e,t])=>({id:e,data:t})).filter(({data:e})=>{let t=e?.createdAt;if(!t||"function"!=typeof t?.toMillis)return!1;let s=t.toMillis();return s>=a.toMillis()&&s<=d.toMillis()}).sort((e,t)=>{let s=e.data?.createdAt?.toMillis?.()??0,r=t.data?.createdAt?.toMillis?.()??0;return s-r}).slice(0,500)}_("info",`تم العثور على ${m.length} سير ذاتية ضمن الفترة.`),j(m.length);let h=s.find(e=>e.id===l),f=h?h.title||h.id:void 0;for(let e of m){let{id:t,data:s}=e;v(e=>e+1);let a=s?.storagePath;if(!a){_("error",`CV ${t}: لا يحتوي على ملف في التخزين؛ تمّ تجاوزه.`);continue}try{if(await (0,n.updateDoc)((0,n.doc)(r,"cvs",t),{jobProfileId:l,jobTitle:f||null,jobProfile:h?{...h,updatedAt:(0,n.serverTimestamp)()}:null,updatedAt:(0,n.serverTimestamp)()}),s?.parsed&&"scanned"===String(s?.status||""))_("info",`CV ${t}: محدّث لملف الوظيفة وسيُعاد التقييم.`);else{let e=await (0,o.mi)(a),s=await fetch(e);if(!s.ok)throw Error(`فشل تنزيل الملف (${s.status})`);let l=await s.blob(),d=(0,c.iH)(i,a);await (0,c.KV)(d,l,{contentType:l.type||"application/pdf",cacheControl:"public, max-age=3600"}),await (0,n.updateDoc)((0,n.doc)(r,"cvs",t),{status:"pending",storagePath:a,rescanRequestedAt:(0,n.serverTimestamp)(),updatedAt:(0,n.serverTimestamp)()}),_("info",`CV ${t}: أُعيد رفع الملف لإعادة الفحص.`)}}catch(e){_("error",`CV ${t}: ${e?.message||"تعذّر الفحص"}`)}}_("info","اكتمل الفحص الجماعي.")}catch(e){_("error",e?.message||"تعذّر تنفيذ الفحص الجماعي")}finally{g(!1)}}return e?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,r.jsxs)("div",{className:"w-full max-w-xl rounded-lg border bg-white p-4 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-sm font-semibold",children:"فحص جماعي للسير الذاتية"}),r.jsx("button",{onClick:t,className:"rounded px-2 py-1 text-xs hover:bg-gray-100",children:"إغلاق"})]}),(0,r.jsxs)("div",{className:"mt-4 space-y-4 text-sm",children:[(0,r.jsxs)("section",{children:[r.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"الملف الوظيفي"}),(0,r.jsxs)("select",{value:l,onChange:e=>d(e.target.value),className:"w-full rounded border p-2 text-xs",children:[r.jsx("option",{value:"",children:"— اختر ملفًا وظيفيًا —"}),s.map(e=>r.jsx("option",{value:e.id,children:e.title||e.id},e.id))]})]}),(0,r.jsxs)("section",{children:[r.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"الفترة الزمنية"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"من تاريخ"}),r.jsx("input",{type:"date",value:u,onChange:e=>x(e.target.value),className:"w-full rounded border p-2 text-xs"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"mb-1 block text-xs text-gray-600",children:"إلى تاريخ"}),r.jsx("input",{type:"date",value:p,onChange:e=>m(e.target.value),className:"w-full rounded border p-2 text-xs"})]})]})]}),(0,r.jsxs)("section",{children:[r.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"الإجراء"}),(0,r.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["المطابقات: ",b," | المُعالَجة: ",f]}),r.jsx("button",{onClick:N,disabled:!w||h,className:"rounded-md bg-indigo-600 px-3 py-2 text-xs text-white hover:bg-indigo-700 disabled:opacity-60",children:h?"جارٍ الفحص…":"فحص السير الذاتية"})]})]}),(0,r.jsxs)("section",{children:[r.jsx("div",{className:"mb-2 text-xs font-medium text-gray-700",children:"السجل"}),r.jsx("div",{className:"rounded-md border bg-gray-50 p-3",children:0===y.length?r.jsx("div",{className:"text-xs text-gray-600",children:"لا توجد رسائل بعد."}):r.jsx("ul",{className:"space-y-1 text-xs",children:y.map((e,t)=>r.jsx("li",{className:"error"===e.type?"text-red-700":"text-gray-800",children:e.message},t))})}),r.jsx("div",{className:"mt-2 flex items-center gap-2",children:r.jsx("button",{onClick:t,className:"rounded-md border bg-white px-3 py-2 text-xs hover:bg-gray-50",children:"إغلاق"})})]})]})]})}):null}function d(){let[e,t]=(0,i.useState)(!1);return(0,r.jsxs)("main",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8",children:[r.jsx(a.Z,{onCheckCv:()=>t(!0)}),r.jsx(l,{isOpen:e,onClose:()=>t(!1)})]})}},29711:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`C:\Users\ace_d\Documents\trae_projects\cvats\apps\web\app\cvs\page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[747,841],()=>s(52338));module.exports=r})();