(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{5113:function(e,t,r){Promise.resolve().then(r.bind(r,2077))},2077:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return G}});var a=r(7437),s=r(2265),n=r(9376),l=r(7648),i=r(6410),o=r(62),c=r(5978),d=r(2660),u=r(2735),m=r(7168),x=r(4760),p=r(9322),g=r(8736),h=r(5802),f=r(3391),v=r(6362),b=r(2369),y=r(5846),j=r(2934),w=r(5005),N=r(5900),k=r(3417),S=r(5621),E=r(1994),A=r(3335),D=r(5685),T=r(8896),C=r(4935),I=r(1239),R=r(9291),F=r(6865);function M(e){let{title:t,children:r}=e;return(0,a.jsxs)("div",{className:"group relative flex items-center justify-center",children:[(0,a.jsx)(D.Z,{className:"h-3 w-3 text-gray-400 ml-1 cursor-help"}),(0,a.jsxs)("div",{className:"absolute bottom-full mb-2 left-1/2 -translate-x-1/2 w-48 p-2 bg-gray-900 text-white text-xs rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[(0,a.jsx)("div",{className:"font-semibold mb-1 border-b border-gray-700 pb-1",children:t}),(0,a.jsx)("div",{className:"space-y-1",children:r}),(0,a.jsx)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-gray-900"})]})]})}function _(e){let{label:t,score:r,icon:s,breakdown:n}=e,l=r>=80?"text-emerald-600 bg-emerald-50 border-emerald-100":r>=60?"text-amber-600 bg-amber-50 border-amber-100":"text-red-600 bg-red-50 border-red-100";return(0,a.jsxs)("div",{className:"rounded-lg border p-3 ".concat(l," relative"),children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-1",children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(s,{className:"h-4 w-4 opacity-70"}),(0,a.jsx)("span",{className:"text-xs font-semibold opacity-90",children:t}),n&&(0,a.jsx)(M,{title:t,children:n.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[e.label,":"]}),(0,a.jsxs)("span",{className:"font-mono",children:[e.value,"/",e.max]})]},t))})]})}),(0,a.jsx)("div",{className:"text-2xl font-bold opacity-90",children:r})]})}function P(e){var t,r,s,n;let{cv:l}=e,i="number"==typeof(null==l?void 0:l.score)?l.score:null,o=null==l?void 0:l.scoreDetailedBreakdown;!o&&(null==l?void 0:l.scoreBreakdown)&&"roleFit"in l.scoreBreakdown&&(o=l.scoreBreakdown);let c=(null==l?void 0:l.scoreRiskFlags)||(null==l?void 0:l.scoreReasons)||[],d=Array.isArray(c)?c.map(e=>"string"==typeof e?{message:e,severity:"medium",type:"other"}:e):[],u=(null==l?void 0:l.scoreBreakdown)||void 0;return(0,a.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden",children:[(0,a.jsx)("div",{className:"border-b border-gray-100 bg-gray-50/50 p-4",children:(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4 text-gray-500"}),"Evaluation Score"]})}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Overall Match"}),(0,a.jsxs)("div",{className:"text-5xl font-bold mt-1 ".concat(null===i?"text-gray-400":i>=80?"text-emerald-600":i>=60?"text-amber-600":"text-red-600"),children:[null!=i?i:"—",(0,a.jsx)("span",{className:"text-xl text-gray-400 font-normal",children:"/100"})]})]}),(null==l?void 0:l.scoreExperienceYears)!==void 0&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 font-medium uppercase tracking-wider",children:"Total Experience"}),(0,a.jsxs)("div",{className:"text-xl font-semibold text-gray-900 mt-1",children:[l.scoreExperienceYears," ",(0,a.jsx)("span",{className:"text-sm font-normal text-gray-500",children:"Years"})]})]})]}),o?(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[(0,a.jsx)(_,{label:"Role Fit",score:o.roleFit.score,icon:T.Z,breakdown:[{label:"Keywords",value:o.roleFit.keywordMatch,max:50},{label:"Seniority",value:o.roleFit.seniorityMatch,max:50}]}),(0,a.jsx)(_,{label:"Skills Quality",score:o.skillsQuality.score,icon:C.Z,breakdown:[{label:"Coverage",value:o.skillsQuality.coverage,max:40},{label:"Depth",value:o.skillsQuality.depth,max:30},{label:"Recency",value:o.skillsQuality.recency,max:30}]}),(0,a.jsx)(_,{label:"Experience",score:o.experienceQuality.score,icon:w.Z,breakdown:[{label:"Relevance",value:o.experienceQuality.relevance,max:50},{label:"Duration",value:o.experienceQuality.duration,max:30},{label:"Consistency",value:o.experienceQuality.consistency,max:20}]}),(0,a.jsx)(_,{label:"Projects",score:o.projectsImpact.score,icon:I.Z,breakdown:[{label:"Presence",value:o.projectsImpact.presence,max:30},{label:"Details",value:o.projectsImpact.details,max:40},{label:"Results",value:o.projectsImpact.results,max:30}]}),(0,a.jsx)(_,{label:"Language",score:o.languageClarity.score,icon:g.Z,breakdown:[{label:"Grammar",value:o.languageClarity.grammar,max:40},{label:"Clarity",value:o.languageClarity.clarity,max:60}]}),(0,a.jsx)(_,{label:"ATS Format",score:o.atsFormat.score,icon:R.Z,breakdown:[{label:"Sections",value:o.atsFormat.sections,max:40},{label:"Readability",value:o.atsFormat.readability,max:30},{label:"Layout",value:o.atsFormat.layout,max:30}]})]}):u&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[(0,a.jsx)(_,{label:"Skills",score:null!==(t=u.skillsScore)&&void 0!==t?t:0,icon:C.Z}),(0,a.jsx)(_,{label:"Experience",score:null!==(r=u.experienceScore)&&void 0!==r?r:0,icon:w.Z}),(0,a.jsx)(_,{label:"Education",score:null!==(s=u.educationScore)&&void 0!==s?s:0,icon:N.Z}),(0,a.jsx)(_,{label:"Format",score:null!==(n=u.formatScore)&&void 0!==n?n:0,icon:R.Z})]}),d&&d.length>0&&(0,a.jsxs)("div",{className:"mt-2 rounded-lg border border-red-100 bg-red-50 p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-red-800 font-semibold text-xs uppercase tracking-wide",children:[(0,a.jsx)(F.Z,{className:"h-4 w-4"}),"Risk Flags"]}),(0,a.jsx)("ul",{className:"space-y-1.5",children:d.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-start gap-2 text-xs text-red-700",children:[(0,a.jsx)("span",{className:"mt-1.5 block h-1.5 w-1.5 rounded-full flex-shrink-0 ".concat("high"===e.severity?"bg-red-600":"medium"===e.severity?"bg-red-400":"bg-amber-400")}),(0,a.jsx)("span",{children:e.message})]},t))})]}),(null==l?void 0:l.scoreInferredSkills)&&l.scoreInferredSkills.length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[(0,a.jsx)("div",{className:"text-xs font-semibold text-gray-900 mb-2",children:"Inferred Skills"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:l.scoreInferredSkills.map((e,t)=>(0,a.jsx)("span",{className:"inline-flex items-center rounded-md bg-indigo-50 px-2 py-1 text-xs font-medium text-indigo-700 border border-indigo-100",children:e},t))})]})]})]})}var L=r(5008);function O(){let e=(0,L._)(["((?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|june|july|august|september|october|november|december)?s*(d{4}))s*(?:-|to|–|—|until|through|s+tos+)s*((?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|june|july|august|september|october|november|december)?s*(d{4}|present|current))"],["((?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|june|july|august|september|october|november|december)?\\s*(\\d{4}))\\s*(?:-|to|–|—|until|through|\\s+to\\s+)\\s*((?:jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec|january|february|march|april|june|july|august|september|october|november|december)?\\s*(\\d{4}|present|current))"]);return O=function(){return e},e}function Z(e){return String(e||"").toLowerCase().replace(/[\u2013\u2014]/g,"-").replace(RegExp("[^\\p{L}\\p{N}+.#\\-\\s]","gu")," ").replace(/\s+/g," ").trim()}function U(e){let t=Z(e);return t?t.split(/\s+/).filter(Boolean):[]}function B(e,t){let r=function(e,t){let r=new Set(U(e)),a=new Set(U(t));if(0===r.size&&0===a.size)return 0;let s=0;for(let e of r)a.has(e)&&s++;let n=r.size+a.size-s||1;return s/n}(e,t),a=1-function(e,t){let r=Z(e),a=Z(t),s=r.length,n=a.length;if(0===s)return n;if(0===n)return s;let l=Array(n+1);for(let e=0;e<=n;e++)l[e]=e;for(let e=1;e<=s;e++){let t=l[0];l[0]=e;for(let s=1;s<=n;s++){let n=l[s],i=r[e-1]===a[s-1]?0:1;l[s]=Math.min(l[s]+1,l[s-1]+1,t+i),t=n}}return l[n]}(e,t)/(Math.max(Z(e).length,Z(t).length)||1),s=U(t).length>1||/[+.-]/.test(t)?.6:.5;return Math.max(0,Math.min(1,s*r+(1-s)*a))}let Q=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","january","february","march","april","june","july","august","september","october","november","december","يناير","فبراير","مارس","أبريل","مايو","يونيو","يوليو","أغسطس","سبتمبر","أكتوبر","نوفمبر","ديسمبر","كانون","شباط","آذار","نيسان","أيار","حزيران","تموز","آب","أيلول","تشرين"];function q(e,t){let r=new Date,a=t&&/\d{4}/.test(t)?Number(t):r.getFullYear();if(e&&Q.includes(e.toLowerCase())){let t=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(e.slice(0,3).toLowerCase());return new Date(a,t>=0?t:0,1)}if(e){let t=e.toLowerCase(),r=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"].indexOf(t.slice(0,3));if(r>=0)return new Date(a,r,1);if(t.includes("يناير")||t.includes("كانون الثاني"))return new Date(a,0,1);if(t.includes("فبراير")||t.includes("شباط"))return new Date(a,1,1);if(t.includes("مارس")||t.includes("آذار"))return new Date(a,2,1);if(t.includes("أبريل")||t.includes("نيسان"))return new Date(a,3,1);if(t.includes("مايو")||t.includes("أيار"))return new Date(a,4,1);if(t.includes("يونيو")||t.includes("حزيران"))return new Date(a,5,1);if(t.includes("يوليو")||t.includes("تموز"))return new Date(a,6,1);if(t.includes("أغسطس")||t.includes("آب"))return new Date(a,7,1);if(t.includes("سبتمبر")||t.includes("أيلول"))return new Date(a,8,1);if(t.includes("أكتوبر")||t.includes("تشرين الأول")||"تشرين"===t)return new Date(a,9,1);if(t.includes("نوفمبر")||t.includes("تشرين الثاني"))return new Date(a,10,1);if(t.includes("ديسمبر")||t.includes("كانون الأول"))return new Date(a,11,1)}return new Date(a,0,1)}function z(e){if(!e)return null;if(/present|current|now|اليوم|الآن|الحالي/i.test(e))return new Date;if(/^\d{4}[-/]\d{1,2}/.test(e)){let t=e.split(/[-/]/);return new Date(parseInt(t[0]),parseInt(t[1])-1,1)}let t=e.split(/[\s,]+/);if(t.length>=2){let e=parseInt(t.find(e=>/\d{4}/.test(e))||""),r=t.find(e=>/[a-zA-Z]+/.test(e));if(e&&r){let t=Q.indexOf(r.toLowerCase());if(t>=0)return new Date(e,t%12,1)}}let r=parseInt(e);return!isNaN(r)&&r>1900&&r<2100?new Date(r,0,1):null}function Y(e){if(0===e.length)return[];e.sort((e,t)=>e.start-t.start);let t=[e[0]];for(let r=1;r<e.length;r++){let a=t[t.length-1],s=e[r];s.start<=a.end?a.end=Math.max(a.end,s.end):t.push(s)}return t}let X=["none","high_school","associate","bachelor","master","phd"];var H=r(257);function W(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,A.m6)((0,E.W)(t))}function G(e){var t,E,A,D,T,C,I,R,F,M,_,L;let{params:Q}=e,G=(0,n.useRouter)(),V=(0,n.useParams)(),K=String((null==Q?void 0:Q.cvId)||(null==V?void 0:V.cvId)||""),[J,$]=(0,s.useState)(null),[ee,et]=(0,s.useState)([]),[er,ea]=(0,s.useState)([]),[es,en]=(0,s.useState)(""),[el,ei]=(0,s.useState)(!1),[eo,ec]=(0,s.useState)(null),[ed,eu]=(0,s.useState)(null),[em,ex]=(0,s.useState)(null),[ep,eg]=(0,s.useState)(100),[eh,ef]=(0,s.useState)([]),[ev,eb]=(0,s.useState)(""),[ey,ej]=(0,s.useState)(!1),[ew,eN]=(0,s.useState)(null),[ek,eS]=(0,s.useState)(null),[eE,eA]=(0,s.useState)(!1),[eD,eT]=(0,s.useState)(null),[eC,eI]=(0,s.useState)("overview");async function eR(){if(K)try{ei(!0),ec(null);let e=(0,i.X9)(),t=(0,c.doc)(e,"cvs",K),r=er.find(e=>e.id===es),a=r?r.title||r.id:void 0;await (0,c.updateDoc)(t,{jobProfileId:es||null,jobTitle:a||null,status:"pending"}),G.refresh()}catch(e){ec((null==e?void 0:e.message)||"تعذّر تحديث ملف الوظيفة")}finally{ei(!1)}}async function eF(){if(ev.trim())try{let e=(0,i.X9)();await (0,c.addDoc)((0,c.collection)(e,"cvs",K,"notes"),{text:ev.trim(),createdAt:(0,c.serverTimestamp)()}),eb("");let t=await (0,c.getDocs)((0,c.query)((0,c.collection)(e,"cvs",K,"notes"),(0,c.limit)(100))),r=[];t.forEach(e=>r.push({id:e.id,...e.data()})),r.sort((e,t)=>{var r,a;return((null==t?void 0:null===(r=t.createdAt)||void 0===r?void 0:r.seconds)||0)-((null==e?void 0:null===(a=e.createdAt)||void 0===a?void 0:a.seconds)||0)}),ef(r)}catch(e){ec((null==e?void 0:e.message)||"تعذّر إضافة الملاحظة")}}async function eM(){if(K)try{ej(!0);let e=(0,i.X9)(),t=(0,c.doc)(e,"cvs",K),r=String((null==J?void 0:J.filename)||"cv.pdf"),a=[];em&&(em.includes("/cvs/")||em.startsWith("cvs/"))&&a.push(em);let s=null==J?void 0:J.companyId;s&&a.push("companies/".concat(s,"/cvs/").concat(K,"/original/").concat(r)),a.push("unscoped/cvs/".concat(K,"/original/").concat(r));let n=null;for(let e of a)!n&&e&&(n=e);if(ek&&n)try{let r=(0,i.bH)(),a=(0,o.ref)(r,n);await (0,o.uploadBytes)(a,ek,{contentType:"application/pdf",cacheControl:"public, max-age=3600"}),await (0,c.updateDoc)(t,{status:"pending",storagePath:n,rescanRequestedAt:(0,c.serverTimestamp)(),updatedAt:(0,c.serverTimestamp)()}),await (0,c.addDoc)((0,c.collection)(e,"cvs",K,"events"),{type:"rescan_uploaded",createdAt:(0,c.serverTimestamp)(),storagePath:n})}catch(r){await (0,c.updateDoc)(t,{status:"pending",rescanRequestedAt:(0,c.serverTimestamp)()}),await (0,c.addDoc)((0,c.collection)(e,"cvs",K,"events"),{type:"rescan_requested",createdAt:(0,c.serverTimestamp)(),error:String((null==r?void 0:r.message)||r||"upload failed")})}else await (0,c.updateDoc)(t,{status:"pending",rescanRequestedAt:(0,c.serverTimestamp)()}),await (0,c.addDoc)((0,c.collection)(e,"cvs",K,"events"),{type:"rescan_requested",createdAt:(0,c.serverTimestamp)()});G.refresh()}catch(e){ec((null==e?void 0:e.message)||"تعذّر طلب إعادة المسح")}finally{ej(!1)}}async function e_(){if(K)try{let e;ej(!0),ec(null);try{let e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,t="1"===String("0");if(e&&t){let e=await Promise.resolve().then(r.bind(r,738)),t=await Promise.resolve().then(r.bind(r,5978)),a={apiKey:"AIzaSyATtmjTHjfMEesV1HQU_x1M3W_g_IWYC-g",authDomain:"cvchk-1a7e0.firebaseapp.com",projectId:"cvchk-1a7e0",storageBucket:"cvchk-1a7e0.firebasestorage.app",messagingSenderId:"318794750",appId:"1:318794750:web:ead1f9207f928eb2696eaf",measurementId:"G-VEX3P44B83"},s=e.getApps().find(e=>"remote"===e.name)||e.initializeApp(a,"remote"),n=t.getFirestore(s),l=t.doc(n,"cvs",K),i=await t.getDoc(l);if(i.exists()){let r=i.data(),s=e.getApps().find(e=>"emu"===e.name)||e.initializeApp(a,"emu"),l=t.getFirestore(s),o=Number(H.env.FIREBASE_EMULATORS_FIRESTORE_PORT||0)||8090;t.connectFirestoreEmulator(l,"127.0.0.1",o),await t.setDoc(t.doc(l,"cvs",K),r,{merge:!0});let d=String((null==r?void 0:r.jobProfileId)||"");if(d){let e=await (0,c.getDoc)((0,c.doc)(n,"jobProfiles",d));e.exists()&&await t.setDoc(t.doc(l,"jobProfiles",d),e.data(),{merge:!0})}}}}catch(e){}let t=String("cvchk-1a7e0"),a="us-central1",s="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,n="1"===String("0"),l=Number(H.env.FIREBASE_EMULATORS_FUNCTIONS_PORT||0)||5001,o=s&&n&&t?"http://127.0.0.1:".concat(l,"/").concat(t,"/").concat(a):t?"https://".concat(a,"-").concat(t,".cloudfunctions.net"):"";if(!o)throw Error("لم يتم ضبط projectId. حدّث .env.local");try{let t=(0,i.kL)().currentUser;if(t){let r=await t.getIdToken();e={Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}}}catch(e){}let d="".concat(o,"/").concat("forceScoreCvPublic","?cvId=").concat(encodeURIComponent(K)),u=await fetch(d,{method:"POST",headers:e});if(!u.ok)throw Error("HTTP ".concat(u.status));G.refresh()}catch(e){try{let t=(0,i.X9)(),r=(0,c.doc)(t,"cvs",K);await (0,c.updateDoc)(r,{status:"pending",scoreRequestedAt:(0,c.serverTimestamp)(),updatedAt:(0,c.serverTimestamp)()}),await (0,c.addDoc)((0,c.collection)(t,"cvs",K,"events"),{type:"score_requested_fallback",createdAt:(0,c.serverTimestamp)(),error:String((null==e?void 0:e.message)||e)}),G.refresh(),await eZ()}catch(t){ec((null==e?void 0:e.message)||"تعذّر تنفيذ التقييم الآن")}}finally{ej(!1)}}async function eP(e){if(K)try{ej(!0);let t=(0,i.X9)(),r=(0,c.doc)(t,"cvs",K);await (0,c.updateDoc)(r,{status:e,updatedAt:(0,c.serverTimestamp)()}),await (0,c.addDoc)((0,c.collection)(t,"cvs",K,"events"),{type:"status_".concat(e),createdAt:(0,c.serverTimestamp)()}),G.refresh()}catch(e){ec((null==e?void 0:e.message)||"تعذّر تغيير الحالة")}finally{ej(!1)}}function eL(e){if(null==e)return"";let t=typeof e;if("string"===t||"number"===t||"boolean"===t)return String(e);if(null==e?void 0:e.seconds)try{return new Date(1e3*e.seconds).toLocaleDateString()}catch(e){}if((null==e?void 0:e.toString)&&"function"==typeof e.toString)try{return String(e.toString())}catch(e){}return""}function eO(e){if("string"==typeof e)return e;let t=eL((null==e?void 0:e.title)||(null==e?void 0:e.role)||(null==e?void 0:e.position)),r=eL(null==e?void 0:e.company),a=eL(null==e?void 0:e.startDate),s=eL(null==e?void 0:e.endDate),n=eL(null==e?void 0:e.description),l=[t,r].filter(Boolean).join(" — "),i=a||s?" (".concat(a||"").concat(s?" - ".concat(s):"",")"):"";return"".concat(l).concat(i).concat(n?" — ".concat(n):"").trim()||JSON.stringify(e)}async function eZ(){try{let t;let r=(0,i.X9)(),a=(0,c.doc)(r,"cvs",K),s=await (0,c.getDoc)(a),n=s.exists()?s.data():J,l=null==n?void 0:n.parsed;if(!l)throw Error("لا توجد بيانات مستخرجة parsed");let o=null,d=es||String((null==n?void 0:n.jobProfileId)||"");if(d&&"auto"!==d)try{let e=await (0,c.getDoc)((0,c.doc)(r,"jobProfiles",d));e.exists()&&(o=e.data())}catch(e){}if(o)t={title:o.title,requiredSkills:Array.isArray(o.requiredSkills)?o.requiredSkills:[],optionalSkills:Array.isArray(o.optionalSkills)?o.optionalSkills:[],minYearsExp:Number(o.minYearsExp)||0,educationLevel:o.educationLevel||"none",weights:o.weights};else{var e;t={requiredSkills:(Array.isArray(null==l?void 0:l.skills)?l.skills:[]).slice(0,8),optionalSkills:[],minYearsExp:Math.min(5,Math.max(1,(null==l?void 0:null===(e=l.experience)||void 0===e?void 0:e.length)||0)),educationLevel:Array.isArray(null==l?void 0:l.education)&&l.education.length>0?"bachelor":"none",title:(null==n?void 0:n.jobTitle)||"General Role",weights:{roleFit:.05,skillsQuality:.5,experienceQuality:.3,projectsImpact:.05,languageClarity:.05,atsFormat:.05}},d="auto"}console.log("Starting scoreCv with:",{parsedKeys:Object.keys(l),jobTitle:t.title});let u=function(e,t){let r={roleFit:.3,skillsQuality:.25,experienceQuality:.2,projectsImpact:.1,languageClarity:.05,atsFormat:.1,...t.weights},a=Object.values(r).reduce((e,t)=>e+t,0)||1,s={roleFit:r.roleFit/a,skillsQuality:r.skillsQuality/a,experienceQuality:r.experienceQuality/a,projectsImpact:r.projectsImpact/a,languageClarity:r.languageClarity/a,atsFormat:r.atsFormat/a},n=(e.skills||[]).map(Z),l=(t.requiredSkills||[]).map(Z).filter(Boolean),i=[...l,...(t.optionalSkills||[]).map(Z).filter(Boolean)],o=function(e,t){let r=Z(e),a=[];for(let e of t){let t=Z(e);if(!t)continue;if(r.includes(t)){a.push(e);continue}let s=U(t)[0];if(!s)continue;let n=r.indexOf(s);n>=0?B(r.slice(Math.max(0,n-40),n+40),t)>=.72&&a.push(e):B(r.slice(0,2e3),t)>=.78&&a.push(e)}return Array.from(new Set(a))}(e.fullText||"",i),c=[];for(let e of i){let t=0,r="parsed";for(let a of n){let s=B(a,e);s>t&&(t=s,r="parsed")}for(let a of o.map(Z)){let s=B(a,e);s>t&&(t=s,r="inferred")}t>.6&&c.push({skill:e,score:Math.round(100*t),source:r})}let d=function(e){if("number"==typeof e.totalExperienceYears&&e.totalExperienceYears>0)return e.totalExperienceYears;if(e.structuredExperience&&e.structuredExperience.length>0){let t=[];for(let r of e.structuredExperience){let e=z(r.startDate),a=r.isCurrent?new Date:z(r.endDate);e&&a&&a.getTime()>e.getTime()&&t.push({start:e.getTime(),end:a.getTime()})}if(t.length>0){let e=Y(t),r=0;for(let t of e)r+=t.end-t.start;return Number(Math.max(0,Math.min(50,r/315576e5)).toFixed(2))}}let t=new Date,r=0,a=[...e.experience||[],Z(e.fullText)],s=RegExp(String.raw(O()),"i"),n=/(\d{4})/g;for(let e of a){let a="string"==typeof e?e:String(e||""),l=s.exec(a);if(l){let[e,a,s,n,i]=l,o=null==a?void 0:a.split(" ")[0],c=null==n?void 0:n.split(" ")[0],d=q(o,s),u=i&&/present|current/i.test(i)?t:q(c,i);d&&u&&u>d&&(r+=u.getTime()-d.getTime());continue}let i=Array.from(a.matchAll(n)).map(e=>Number(e[1])).filter(e=>e>=1970&&e<=2100);if(i.length>=2){let e=new Date(Math.min(...i),0,1),t=new Date(Math.max(...i),0,1);t>e&&(r+=t.getTime()-e.getTime())}}return Number(Math.max(0,Math.min(50,r/315576e5)).toFixed(2))}(e),u=function(e,t){if(!e.structuredExperience||0===e.structuredExperience.length)return 0;let r=Z(t.title||""),a=new Set([...t.requiredSkills||[],...t.optionalSkills||[]].map(Z)),s=[];for(let t of e.structuredExperience){let e=!1,n=Z(t.role),l=Z(t.description);if(r&&n){if(B(n,r)>.6)e=!0;else{let t=U(n),a=U(r).filter(e=>e.length>3),s=a.filter(e=>t.some(t=>t.includes(e)||e.includes(t)));s.length>=1&&a.length<=2?e=!0:s.length>=2&&(e=!0)}}if(!e&&a.size>0){let t=0;for(let e of a)n.includes(e)||l.includes(e)?t++:e.length>4&&(B(n,e)>.8||B(l,e)>.8)&&t++;t>=2?e=!0:t>=1&&a.size<=3&&(e=!0)}if(e){let e=z(t.startDate),r=t.isCurrent?new Date:z(t.endDate);e&&r&&r.getTime()>e.getTime()&&s.push({start:e.getTime(),end:r.getTime()})}if(s.length>0){let e=Y(s),t=0;for(let r of e)t+=r.end-r.start;return Number(Math.max(0,Math.min(50,t/315576e5)).toFixed(2))}}return 0}(e,t),m=function(e){let t=Z(e.fullText+" "+(e.education||[]).join(" "));return/phd|doctorate|dr\.?\s|doctoral|دكتوراه/i.test(t)?"phd":/master|msc|m\.sc|mtech|m\.tech|ma\b|m\.a|mba|ماجستير/i.test(t)?"master":/bachelor|bsc|b\.sc|btech|b\.tech|ba\b|b\.a|bs\b|b\.s|بكالوريوس/i.test(t)?"bachelor":/associate|diploma|community college|دبلوم|معهد/i.test(t)?"associate":/high\s*school|secondary\s*school|ged|ثانوية|ثانوي/i.test(t)?"high_school":"none"}(e),x=function(e,t,r,a){let s=t.length||1,n=e.filter(e=>e.score>70).length,l=Math.round(50*Math.min(1,n/s)),i=Math.round(50*(a>0?Math.min(1,r/a):1));return{score:l+i,keywordMatch:l,seniorityMatch:i}}(c,l,u,t.minYearsExp),p=function(e,t,r){if(0===r.length)return{score:100,coverage:40,depth:30,recency:30};let a=t.length/r.length,s=0;if(e.structuredExperience)for(let r of t){let t=Z(r.skill);e.structuredExperience.some(e=>Z(e.description).includes(t)||Z(e.role).includes(t))&&s++}let n=t.length>0?s/t.length:0,l=0;if(e.structuredExperience&&e.structuredExperience.length>0){let r=e.structuredExperience[0],a=Z(r.description+" "+r.role),s=t.filter(e=>a.includes(Z(e.skill))).length;l=t.length>0?s/t.length:0}let i=Math.round(40*a),o=Math.round(30*n),c=Math.round(30*l);return{score:i+o+c,coverage:i,depth:o,recency:c}}(e,c,l),g=function(e,t,r,a){let s=a>0?Math.min(1.2,t/a):1,n=1;if(e.structuredExperience&&e.structuredExperience.length>1){let t=[];for(let r of e.structuredExperience){let e=z(r.startDate),a=r.isCurrent?new Date:z(r.endDate);e&&a&&t.push({start:e.getTime(),end:a.getTime()})}t.sort((e,t)=>e.start-t.start);for(let e=0;e<t.length-1;e++)t[e+1].start-t[e].end>15552e6&&(n-=.1)}let l=Math.round(50*(r>0?Math.min(1,t/r):0)),i=Math.round((s>1?1:s)*30),o=Math.round(20*(n=Math.max(0,n)));return{score:l+i+o,relevance:l,duration:i,consistency:o}}(e,u,d,t.minYearsExp),h=function(e){let t=0,r=0,a=0;if(e.structuredExperience&&e.structuredExperience.length>0){t=30;let s=!1,n=!1,l=/\d+%|\$\d+|\d+x/i;for(let t of e.structuredExperience)t.description&&t.description.length>50&&(n=!0),l.test(t.description)&&(s=!0);n&&(r=40),s&&(a=30)}else e.experience&&e.experience.length>0&&(t=20);return{score:t+r+a,presence:t,details:r,results:a}}(e),f=function(e){let t=40,r=60,a=e.fullText||"";a.length<200&&(t-=10,r-=20);let s=a.match(/[A-Z\s]{20,}/g);return s&&s.length>2&&(r-=10),/[•\-\*]\s/.test(a)||(r-=10),{score:(t=Math.max(0,t))+(r=Math.max(0,r)),grammar:t,clarity:r}}(e),v=function(e){let t=0,r=0,a=0,s=!!e.name,n=!!e.email,l=!!e.phone,i=!!e.summary,o=e.skills&&e.skills.length>0,c=e.structuredExperience&&e.structuredExperience.length>0||e.experience&&e.experience.length>0,d=e.education&&e.education.length>0;return s&&(t+=5),n&&(t+=5),l&&(t+=5),i&&(t+=5),o&&(t+=10),c&&(t+=5),d&&(t+=5),r=30,e.email||e.phone||(r-=10),{score:t+r+(a=30),sections:t,readability:r,layout:a}}(e);return{score:Math.round(s.roleFit*x.score+s.skillsQuality*p.score+s.experienceQuality*g.score+s.projectsImpact*h.score+s.languageClarity*f.score+s.atsFormat*v.score),breakdown:{roleFit:x,skillsQuality:p,experienceQuality:g,projectsImpact:h,languageClarity:f,atsFormat:v},riskFlags:function(e,t,r,a){let s=[];if(e.structuredExperience){let t=[];for(let r of e.structuredExperience){let e=z(r.startDate),a=r.isCurrent?new Date:z(r.endDate);e&&a&&t.push({start:e.getTime(),end:a.getTime()})}t.sort((e,t)=>e.start-t.start);for(let e=0;e<t.length-1;e++){let r=(t[e+1].start-t[e].end)/864e5;r>180&&s.push({type:"gap",severity:r>365?"high":"medium",message:"Employment gap of ".concat(Math.round(r/30)," months detected.")})}}if(e.structuredExperience&&e.structuredExperience.length>2){let t=0;for(let r of e.structuredExperience){let e=z(r.startDate),a=r.isCurrent?new Date:z(r.endDate);e&&a&&(t+=(a.getTime()-e.getTime())/2592e6)}t/e.structuredExperience.length<12&&s.push({type:"job_hopping",severity:"medium",message:"Average tenure is less than 1 year, indicating potential job hopping."})}return e.email||e.phone||s.push({type:"missing_contact",severity:"high",message:"No email or phone number found."}),X.indexOf(a)<X.indexOf(t.educationLevel)&&s.push({type:"missing_education",severity:"medium",message:"Education level (".concat(a,") is below required (").concat(t.educationLevel,").")}),s}(e,t,0,m),reasons:[],inferredSkills:o,matchedSkills:c,normalizedWeights:s,experienceYears:d,relevantExperienceYears:u,educationDetected:m}}(l,t);if(console.log("scoreCv result:",u),!u)throw Error("Internal Error: Scoring engine returned no result");let m=u.breakdown||{roleFit:{score:0,keywordMatch:0,seniorityMatch:0},skillsQuality:{score:0,coverage:0,depth:0,recency:0},experienceQuality:{score:0,relevance:0,duration:0,consistency:0},projectsImpact:{score:0,presence:0,details:0,results:0},languageClarity:{score:0,grammar:0,clarity:0},atsFormat:{score:0,sections:0,readability:0,layout:0}},x="number"==typeof u.score?u.score:0,p=u.riskFlags||[],g="Candidate scored ".concat(x,"/100 based on the target role '").concat(t.title||"General","'.\n\n"),h=(u.matchedSkills||[]).filter(e=>e.score>50).length;g+="• Skills Quality (".concat(m.skillsQuality.score,"%): Found ").concat(h," matching skills out of ").concat((t.requiredSkills||[]).length," required.\n");let f=(u.matchedSkills||[]).filter(e=>e.score>80).map(e=>e.skill);f.length>0&&(g+="  Matches: ".concat(f.slice(0,5).join(", ")).concat(f.length>5?", ...":"",".\n")),g+="• Experience Quality (".concat(m.experienceQuality.score,"%): ").concat(u.experienceYears||0," years total, ").concat(u.relevantExperienceYears||0," years relevant.\n")+"• Role Fit (".concat(m.roleFit.score,"%): Education level identified as '").concat(u.educationDetected||"none","'.\n");let v=(u.reasons||[]).map(e=>"• ".concat(e)).join("\n");p.length>0&&(v+="\n\nRisk Flags:\n"+p.map(e=>"• [".concat(e.severity.toUpperCase(),"] ").concat(e.message)).join("\n")),v||(v="No major improvements detected. The profile is well-aligned with the target role.");let b={score:x,scoreBreakdown:m,scoreDetailedBreakdown:m,scoreRiskFlags:p,scoreExperienceYears:u.experienceYears||0,scoreEducationDetected:u.educationDetected||"none",scoreInferredSkills:u.inferredSkills||[],aiAnalysis:g,improvements:v,updatedAt:(0,c.serverTimestamp)()};d&&"auto"!==d&&(b.jobProfileId=d),await (0,c.updateDoc)(a,b);let y={...n,...b};$(y)}catch(e){console.error("Local scoring error:",e),ec("فشل التقييم المحلي: "+e.message)}}return(0,s.useEffect)(()=>{let e=!0,t=null;return(async()=>{try{var r;ec(null);let a=(0,i.kL)(),s=null===(r=a.currentUser)||void 0===r?void 0:r.uid;if(!s){ec("غير مصرح: الرجاء تسجيل الدخول");return}let n=(0,i.X9)(),l=(0,c.doc)(n,"cvs",K);t=(0,c.onSnapshot)(l,async t=>{if(e&&t.exists()){let r=t.data();if((null==r?void 0:r.uid)&&r.uid!==s){ec("غير مصرح: لا تملك هذه السيرة الذاتية");return}$({id:K,...r}),en(String((null==r?void 0:r.jobProfileId)||"")),(async t=>{let r=null==t?void 0:t.storagePath,a=String((null==t?void 0:t.filename)||"cv.pdf"),s=null==t?void 0:t.companyId,n=[];for(let t of(r&&(n.push(r),e&&ex(r)),s&&n.push("companies/".concat(s,"/cvs/").concat(K,"/original/").concat(a)),n.push("unscoped/cvs/".concat(K,"/original/").concat(a)),n))try{let r=await (0,i.mi)(t);if(r&&e){eu(r),ex(t);return}}catch(e){}try{let t=(0,i.bH)(),r=[];for(let a of(s&&(r.push("companies/".concat(s,"/cvs/").concat(K,"/original/")),r.push("companies/".concat(s,"/cvs/").concat(K,"/"))),r.push("unscoped/cvs/".concat(K,"/original/")),r.push("unscoped/cvs/".concat(K,"/")),r))try{let r=(0,o.ref)(t,a),s=await (0,o.listAll)(r),n=s.items.find(e=>e.name.toLowerCase().endsWith(".pdf"))||s.items[0];if(n){let t=await (0,o.getDownloadURL)(n);if(t&&e){eu(t),ex(n.fullPath||a+n.name);return}}}catch(e){}}catch(e){}})(r)}});let d=await (0,c.getDocs)((0,c.query)((0,c.collection)(n,"cvs",K,"events"),(0,c.limit)(50))),u=[];d.forEach(e=>u.push({id:e.id,...e.data()})),u.sort((e,t)=>{var r,a;return((null==t?void 0:null===(r=t.createdAt)||void 0===r?void 0:r.seconds)||0)-((null==e?void 0:null===(a=e.createdAt)||void 0===a?void 0:a.seconds)||0)}),et(u);let m=await (0,c.getDocs)((0,c.query)((0,c.collection)(n,"cvs",K,"notes"),(0,c.limit)(100))),x=[];m.forEach(e=>x.push({id:e.id,...e.data()})),x.sort((e,t)=>{var r,a;return((null==t?void 0:null===(r=t.createdAt)||void 0===r?void 0:r.seconds)||0)-((null==e?void 0:null===(a=e.createdAt)||void 0===a?void 0:a.seconds)||0)}),ef(x);let p=await (0,c.getDocs)((0,c.query)((0,c.collection)(n,"jobProfiles"),(0,c.where)("uid","==",s),(0,c.limit)(50))),g=[];p.forEach(e=>g.push({id:e.id,...e.data()})),g.sort((e,t)=>String(e.title||e.id).localeCompare(String(t.title||t.id))),ea(g)}catch(e){ec((null==e?void 0:e.message)||"فشل تحميل التفاصيل")}})(),()=>{if(e=!1,t)try{t()}catch(e){}}},[K]),(0,s.useEffect)(()=>{let e=!0;return async function(){if(!ed){eN(null),eT(null);return}try{eA(!0),eT(null);let t=null;try{if(em){let e=(0,i.bH)(),a=(0,o.ref)(e,em),s=await Promise.resolve().then(r.bind(r,62));(null==s?void 0:s.getBlob)&&(t=await s.getBlob(a))}}catch(a){let t=String((null==a?void 0:a.code)||""),r=String((null==a?void 0:a.message)||"").toLowerCase();if(t.includes("storage/unauthorized")||r.includes("permission")||r.includes("403")){e&&eT("صلاحيات غير كافية");return}if(t.includes("storage/object-not-found")||r.includes("not found")||r.includes("404")){e&&eT("الملف غير موجود في التخزين");return}}if(!t){let e;try{let t=(0,i.kL)().currentUser;if(t){let r=await t.getIdToken();e={Authorization:"Bearer ".concat(r)}}}catch(e){}let r=await fetch(ed,{method:"GET",headers:e});if(!r.ok)throw Error("HTTP ".concat(r.status));t=await r.blob()}let a=URL.createObjectURL(t);e&&(eN(a),eS(t))}catch(t){e&&eT((null==t?void 0:t.message)||"تعذّر تحميل ملف PDF")}finally{e&&eA(!1)}}(),()=>{e=!1,ew&&URL.revokeObjectURL(ew)}},[ed,em]),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50/50 pb-12",children:[(0,a.jsx)("header",{className:"sticky top-0 z-30 border-b bg-white/80 px-6 py-4 backdrop-blur-md",children:(0,a.jsxs)("div",{className:"mx-auto flex max-w-7xl items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(l.default,{href:"/Dashboard",className:"group flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 bg-white text-gray-500 transition-colors hover:border-gray-300 hover:text-gray-900",children:(0,a.jsx)(d.Z,{className:"h-4 w-4 transition-transform group-hover:-translate-x-0.5"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs font-medium text-gray-500",children:[(0,a.jsx)(l.default,{href:"/Dashboard",className:"hover:text-gray-900",children:"Candidates"}),(0,a.jsx)("span",{children:"/"}),(0,a.jsx)("span",{className:"text-gray-900",children:(null==J?void 0:null===(t=J.parsed)||void 0===t?void 0:t.name)||(null==J?void 0:J.name)||"Candidate Profile"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:(null==J?void 0:null===(E=J.parsed)||void 0===E?void 0:E.name)||(null==J?void 0:J.name)||"Loading..."}),(null==J?void 0:J.status)&&(0,a.jsx)("span",{className:W("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium capitalize",{uploaded:"bg-slate-100 text-slate-700 border-slate-200",pending:"bg-amber-50 text-amber-700 border-amber-200",scanned:"bg-blue-50 text-blue-700 border-blue-200",parsed:"bg-indigo-50 text-indigo-700 border-indigo-200",scored:"bg-emerald-50 text-emerald-700 border-emerald-200",accepted:"bg-green-50 text-green-700 border-green-200",rejected:"bg-red-50 text-red-700 border-red-200",scan_failed:"bg-red-50 text-red-700 border-red-200"}[J.status]||"bg-gray-100 text-gray-800"),children:J.status})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center rounded-lg border bg-white p-1 shadow-sm",children:[(0,a.jsxs)("button",{onClick:function(){if(!ed)return;let e=document.createElement("a");e.href=ed,e.download=(null==J?void 0:J.filename)||"cv.pdf",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:!ed,className:"inline-flex h-8 items-center gap-2 rounded-md px-3 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",title:"Download Original PDF",children:[(0,a.jsx)(u.Z,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Download"})]}),(0,a.jsx)("div",{className:"mx-1 h-4 w-px bg-gray-200"}),(0,a.jsxs)("button",{onClick:eM,disabled:ey,className:"inline-flex h-8 items-center gap-2 rounded-md px-3 text-xs font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",title:"Rescan Document",children:[(0,a.jsx)(m.Z,{className:W("h-3.5 w-3.5",ey&&"animate-spin")}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Rescan"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{className:"h-9 rounded-lg border-gray-200 bg-white text-sm font-medium text-gray-700 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",value:(null==J?void 0:J.status)||"",onChange:e=>eP(e.target.value),children:[(0,a.jsx)("option",{value:"uploaded",children:"Uploaded"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"scanned",children:"Scanned"}),(0,a.jsx)("option",{value:"parsed",children:"Parsed"}),(0,a.jsx)("option",{value:"scored",children:"Scored"}),(0,a.jsx)("option",{value:"accepted",children:"Accepted"}),(0,a.jsx)("option",{value:"rejected",children:"Rejected"})]}),(0,a.jsxs)("button",{onClick:e_,disabled:ey,className:"inline-flex h-9 items-center gap-2 rounded-lg bg-indigo-600 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 disabled:opacity-50",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Evaluate"})]})]})]})]})}),eo&&(0,a.jsx)("div",{className:"mx-auto mt-6 max-w-7xl px-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("p",{children:eo})]})}),(0,a.jsxs)("main",{className:"mx-auto mt-8 grid max-w-7xl grid-cols-1 gap-8 px-6 lg:grid-cols-12",children:[(0,a.jsx)("div",{className:"lg:col-span-7 xl:col-span-8",children:(0,a.jsxs)("div",{className:"sticky top-24 overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-100 bg-gray-50/50 px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Original Resume"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 rounded-md border bg-white p-1 shadow-sm",children:[(0,a.jsx)("button",{onClick:()=>eg(e=>Math.max(50,e-10)),className:"p-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-900 rounded",children:(0,a.jsx)(h.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsxs)("span",{className:"min-w-[3rem] text-center text-xs font-medium text-gray-600",children:[ep,"%"]}),(0,a.jsx)("button",{onClick:()=>eg(e=>Math.min(200,e+10)),className:"p-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-900 rounded",children:(0,a.jsx)(f.Z,{className:"h-3.5 w-3.5"})}),(0,a.jsx)("div",{className:"mx-1 h-3 w-px bg-gray-200"}),ed&&(0,a.jsx)("a",{href:ed,target:"_blank",rel:"noopener noreferrer",className:"p-1.5 text-gray-500 hover:bg-gray-50 hover:text-gray-900 rounded",title:"Open in new tab",children:(0,a.jsx)(v.Z,{className:"h-3.5 w-3.5"})})]})]}),(0,a.jsx)("div",{className:"relative h-[calc(100vh-12rem)] min-h-[600px] w-full bg-gray-100/50",children:ew||ed?(0,a.jsx)("div",{className:"h-full w-full overflow-auto p-4 flex justify-center",children:(0,a.jsx)("div",{style:{width:"".concat(ep,"%"),transition:"width 0.2s"},className:"shadow-lg",children:(0,a.jsx)("iframe",{src:ew||ed||void 0,className:"h-[calc(100vh-14rem)] min-h-[800px] w-full rounded bg-white",title:"PDF Viewer"})})}):(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-gray-500",children:[(0,a.jsx)("div",{className:"rounded-full bg-gray-100 p-4",children:(0,a.jsx)(g.Z,{className:"h-8 w-8 text-gray-400"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"No Document Available"}),eE&&(0,a.jsx)("p",{className:"text-xs mt-1",children:"Loading document from secure storage..."}),eD&&(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:eD})]})]})})]})}),(0,a.jsxs)("div",{className:"space-y-6 lg:col-span-5 xl:col-span-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:[(0,a.jsx)("div",{className:"border-b border-gray-100 px-1",children:(0,a.jsx)("div",{className:"flex gap-1",children:["overview","analysis","raw"].map(e=>(0,a.jsx)("button",{onClick:()=>eI(e),className:W("flex-1 border-b-2 px-4 py-3 text-sm font-medium transition-colors",eC===e?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"),children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),(0,a.jsxs)("div",{className:"p-5",children:["overview"===eC&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-lg bg-indigo-50/50 p-4 border border-indigo-100",children:[(0,a.jsx)("label",{className:"text-xs font-semibold text-indigo-900 uppercase tracking-wider mb-2 block",children:"Target Role"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("select",{className:"flex-1 rounded-md border-indigo-200 bg-white py-1.5 text-sm text-gray-700 focus:border-indigo-500 focus:ring-indigo-500",value:es,onChange:e=>en(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"Select a job profile..."}),er.map(e=>(0,a.jsx)("option",{value:e.id,children:e.title||e.id},e.id))]}),(0,a.jsx)("button",{onClick:eR,disabled:el,className:"rounded-md bg-indigo-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-indigo-700 disabled:opacity-50",children:el?"...":"Save"})]})]}),(0,a.jsx)(P,{cv:J}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 text-gray-500"}),"Contact Details"]}),(0,a.jsxs)("div",{className:"grid gap-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between rounded-md border border-gray-100 bg-gray-50 p-2.5",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Email"}),(0,a.jsx)("span",{className:"font-medium text-gray-900 select-all",children:(null==J?void 0:null===(A=J.parsed)||void 0===A?void 0:A.email)||(null==J?void 0:J.email)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between rounded-md border border-gray-100 bg-gray-50 p-2.5",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"Phone"}),(0,a.jsx)("span",{className:"font-medium text-gray-900 select-all",children:(null==J?void 0:null===(D=J.parsed)||void 0===D?void 0:D.phone)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-start justify-between rounded-md border border-gray-100 bg-gray-50 p-2.5",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"LinkedIn"}),(null==J?void 0:null===(T=J.parsed)||void 0===T?void 0:T.linkedin)?(0,a.jsxs)("a",{href:J.parsed.linkedin,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 font-medium text-indigo-600 hover:underline",children:["View Profile ",(0,a.jsx)(v.Z,{className:"h-3 w-3"})]}):(0,a.jsx)("span",{className:"text-gray-400",children:"Not found"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 text-gray-500"}),"Detected Skills"]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1.5",children:Array.isArray(null==J?void 0:null===(C=J.parsed)||void 0===C?void 0:C.skills)&&J.parsed.skills.length>0?J.parsed.skills.map((e,t)=>(0,a.jsx)("span",{className:"inline-flex items-center rounded-md bg-white px-2 py-1 text-xs font-medium text-gray-700 border border-gray-200 shadow-sm",children:e},t)):(0,a.jsx)("span",{className:"text-sm text-gray-500 italic",children:"No skills detected yet."})})]})]}),"analysis"===eC&&(0,a.jsxs)("div",{className:"space-y-6",children:[(null==J?void 0:null===(I=J.parsed)||void 0===I?void 0:I.aiAnalysis)||(null==J?void 0:J.aiAnalysis)?(0,a.jsxs)("div",{className:"rounded-lg border border-indigo-100 bg-indigo-50/30 p-4",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-indigo-900",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),"AI Analysis"]}),(0,a.jsx)("div",{className:"prose prose-sm prose-indigo max-w-none text-gray-700",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed text-xs",children:(null==J?void 0:null===(R=J.parsed)||void 0===R?void 0:R.aiAnalysis)||(null==J?void 0:J.aiAnalysis)})})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-lg border border-dashed border-gray-300 bg-gray-50 py-12 text-center",children:[(0,a.jsx)(x.Z,{className:"h-10 w-10 text-gray-400 mb-3"}),(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:"No AI analysis available yet"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500 mb-4",children:"Run a rescan to generate the CV Coach feedback."}),(0,a.jsx)("button",{onClick:eM,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Generate Analysis"})]}),((null==J?void 0:null===(F=J.parsed)||void 0===F?void 0:F.improvements)||(null==J?void 0:J.improvements))&&(0,a.jsxs)("div",{className:"rounded-lg border border-emerald-100 bg-emerald-50/30 p-4",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center gap-2 text-sm font-semibold text-emerald-900",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),"Suggested Improvements"]}),(0,a.jsx)("div",{className:"prose prose-sm prose-emerald max-w-none text-gray-700",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed text-xs",children:J.parsed.improvements})})]})]}),"raw"===eC&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4 text-gray-500"}),"Experience"]}),(0,a.jsx)("ul",{className:"space-y-3",children:Array.isArray(null==J?void 0:null===(M=J.parsed)||void 0===M?void 0:M.structuredExperience)&&J.parsed.structuredExperience.length>0?J.parsed.structuredExperience.map((e,t)=>(0,a.jsx)("li",{className:"rounded-md border border-gray-100 bg-gray-50 p-3 text-xs text-gray-600",children:eO(e)},t)):Array.isArray(null==J?void 0:null===(_=J.parsed)||void 0===_?void 0:_.experience)&&J.parsed.experience.length>0?J.parsed.experience.map((e,t)=>(0,a.jsx)("li",{className:"rounded-md border border-gray-100 bg-gray-50 p-3 text-xs text-gray-600",children:eO(e)},t)):(0,a.jsx)("li",{className:"text-sm text-gray-500 italic",children:"No experience data."})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(N.Z,{className:"h-4 w-4 text-gray-500"}),"Education"]}),(0,a.jsx)("ul",{className:"space-y-3",children:Array.isArray(null==J?void 0:null===(L=J.parsed)||void 0===L?void 0:L.education)&&J.parsed.education.length>0?J.parsed.education.map((e,t)=>(0,a.jsx)("li",{className:"rounded-md border border-gray-100 bg-gray-50 p-3 text-xs text-gray-600",children:function(e){if("string"==typeof e)return e;let t=eL((null==e?void 0:e.degree)||(null==e?void 0:e.certification)||(null==e?void 0:e.title)||(null==e?void 0:e.program)),r=eL((null==e?void 0:e.school)||(null==e?void 0:e.university)||(null==e?void 0:e.institution)),a=eL(null==e?void 0:e.startDate),s=eL(null==e?void 0:e.endDate),n=eL(null==e?void 0:e.description),l=[t,r].filter(Boolean).join(" — "),i=a||s?" (".concat(a||"").concat(s?" - ".concat(s):"",")"):"";return"".concat(l).concat(i).concat(n?" — ".concat(n):"").trim()||JSON.stringify(e)}(e)},t)):(0,a.jsx)("li",{className:"text-sm text-gray-500 italic",children:"No education data."})})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm p-5",children:[(0,a.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,a.jsxs)("h3",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(k.Z,{className:"h-4 w-4 text-gray-500"}),"Notes"]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex gap-2",children:(0,a.jsx)("textarea",{value:ev,onChange:e=>eb(e.target.value),placeholder:"Add a note...",className:"w-full min-h-[80px] rounded-lg border-gray-200 bg-gray-50 p-3 text-sm focus:border-indigo-500 focus:ring-indigo-500"})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:eF,disabled:!ev.trim(),className:"rounded-md bg-white px-3 py-1.5 text-xs font-medium text-gray-700 border border-gray-200 hover:bg-gray-50 disabled:opacity-50",children:"Add Note"})})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-4 max-h-[300px] overflow-y-auto pr-2",children:[eh.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("div",{className:"mt-1 h-2 w-2 rounded-full bg-indigo-400 flex-shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:e.text}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:(null===(t=e.createdAt)||void 0===t?void 0:t.seconds)?new Date(1e3*e.createdAt.seconds).toLocaleString():"Just now"})]})]},e.id)}),0===eh.length&&(0,a.jsx)("p",{className:"text-center text-xs text-gray-400 py-4",children:"No notes added yet."})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm p-5",children:[(0,a.jsxs)("h3",{className:"mb-4 flex items-center gap-2 text-sm font-semibold text-gray-900",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 text-gray-500"}),"Activity Log"]}),(0,a.jsxs)("div",{className:"relative border-l border-gray-200 ml-2 space-y-6 pl-6",children:[ee.map(e=>{var t;return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("span",{className:"absolute -left-[29px] top-1 flex h-3 w-3 items-center justify-center rounded-full border border-white bg-indigo-500 ring-4 ring-gray-50"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-900",children:e.type.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}),(0,a.jsx)("p",{className:"text-[10px] text-gray-400 mt-0.5",children:(null===(t=e.createdAt)||void 0===t?void 0:t.seconds)?new Date(1e3*e.createdAt.seconds).toLocaleString():""}),"number"==typeof e.score&&(0,a.jsxs)("span",{className:"mt-1 inline-block rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-700 border border-emerald-100",children:["Score: ",e.score]})]})]},e.id)}),0===ee.length&&(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"No activity recorded."})]})]})]})]})]})]})}},6410:function(e,t,r){"use strict";r.d(t,{X9:function(){return u},bH:function(){return m},kL:function(){return d},m6:function(){return p},mi:function(){return x}});var a=r(738),s=r(3301),n=r(5978),l=r(62),i=r(257);let o={apiKey:"AIzaSyATtmjTHjfMEesV1HQU_x1M3W_g_IWYC-g",authDomain:"cvchk-1a7e0.firebaseapp.com",projectId:"cvchk-1a7e0",storageBucket:"cvchk-1a7e0.firebasestorage.app",messagingSenderId:"318794750",appId:"1:318794750:web:ead1f9207f928eb2696eaf",measurementId:"G-VEX3P44B83"},c=null;function d(){return c||(c=(0,a.getApps)().length?(0,a.getApps)()[0]:(0,a.initializeApp)(o)),(0,s.v0)(c)}function u(){c||(c=(0,a.getApps)().length?(0,a.getApps)()[0]:(0,a.initializeApp)(o));let e=(0,n.getFirestore)(c);try{let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,r="1"===String("0"),a=Number(i.env.FIREBASE_EMULATORS_FIRESTORE_PORT||0)||8090;t&&r&&(0,n.connectFirestoreEmulator)(e,"127.0.0.1",a)}catch(e){}return e}function m(){c||(c=(0,a.getApps)().length?(0,a.getApps)()[0]:(0,a.initializeApp)(o));let e=(0,l.getStorage)(c);try{let t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,r="1"===String("0"),a=Number(i.env.FIREBASE_EMULATORS_STORAGE_PORT||0)||9199;t&&r&&(0,l.connectStorageEmulator)(e,"127.0.0.1",a)}catch(e){}return e}async function x(e){let t=m();try{let r=(0,l.ref)(t,e);return await (0,l.getDownloadURL)(r)}catch(t){try{let t=String("cvchk-1a7e0.firebasestorage.app"),r="1"===String("0")?"http://127.0.0.1:"+(i.env.FIREBASE_EMULATORS_STORAGE_PORT||9199):"https://firebasestorage.googleapis.com",a=t.endsWith(".appspot.com")||t.endsWith(".firebasestorage.app")?t:"".concat(t),s=encodeURIComponent(e);return"".concat(r,"/v0/b/").concat(a,"/o/").concat(s,"?alt=media")}catch(e){throw t}}}async function p(){try{var e,t;let r=d(),a=r.currentUser;if(null==a?void 0:a.uid)return a.uid;if(await new Promise(e=>(0,s.Aj)(r,e)),null===(e=r.currentUser)||void 0===e?void 0:e.uid)return r.currentUser.uid;if(await (0,s.XB)(r),await new Promise(e=>(0,s.Aj)(r,e)),!(null===(t=r.currentUser)||void 0===t?void 0:t.uid))throw Error("Unable to establish user session");return r.currentUser.uid}catch(a){let e=String((null==a?void 0:a.code)||"").toLowerCase(),t=String((null==a?void 0:a.message)||"").toLowerCase();"localhost"===window.location.hostname||window.location.hostname;let r="1"===(i.env.NEXT_PUBLIC_FORCE_DEV_UID||"");if(t.includes("invalid-api-key")||e.includes("admin-restricted-operation")||e.includes("operation-not-allowed")||e.includes("network-request-failed")||e.includes("config")||r)try{let e="dev:uid",t=window.localStorage.getItem(e);return t||(t="dev-".concat(Math.random().toString(36).slice(2)),window.localStorage.setItem(e,t)),t}catch(e){return"dev-".concat(Date.now())}throw a}}}},function(e){e.O(0,[358,139,2,648,354,971,117,744],function(){return e(e.s=5113)}),_N_E=e.O()}]);