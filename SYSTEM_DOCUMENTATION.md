# توثيق النظام (System Documentation)

## 1. نظرة عامة على النظام
هذا النظام هو **CVATS (CV Analysis & Tracking System)**، وقد تم تبسيطه ليعمل كـ **"ماسح ضوئي للسير الذاتية" (CV Scanner)**.
الهدف الرئيسي للنظام هو أتمتة عملية قراءة وتقييم السير الذاتية للمرشحين باستخدام الذكاء الاصطناعي (AI)، مما يوفر الوقت والجهد في فرز المتقدمين للوظائف.

النظام لم يعد يعتمد على "حالات" معقدة (مثل: جديد، مقابلة، مقبول، مرفوض)، بل يركز على وظيفة أساسية واحدة: **مسح السيرة الذاتية وإعطاء تقييم فوري**.

## 2. آلية عمل النظام (Workflow)

يعمل النظام وفق الخطوات التالية:

1. **رفع السيرة الذاتية (Upload)**:
   - يقوم المستخدم برفع ملف السيرة الذاتية (بصيغة PDF).
   - يتم تخزين الملف في **Firebase Storage**.

2. **استخراج النصوص (Text Extraction)**:
   - يقوم النظام بقراءة محتوى ملف الـ PDF واستخراج النصوص منه باستخدام مكتبة `pdfjs-dist`.

3. **التحليل والتقييم بالذكاء الاصطناعي (AI Scoring)**:
   - يتم إرسال نص السيرة الذاتية + الوصف الوظيفي (Job Description) إلى محرك الذكاء الاصطناعي (Google Gemini).
   - يقوم الذكاء الاصطناعي بتحليل مدى تطابق المرشح مع الوظيفة.
   - **المخرجات**:
     - نسبة التوافق (Score %): من 0 إلى 100.
     - ملخص عن المرشح.
     - سنوات الخبرة المستخرجة.
     - المهارات الرئيسية.

4. **حساب التكاليف (Cost Tracking)**:
   - في كل عملية تحليل، يقوم النظام بحساب عدد الـ Tokens المستهلكة (Input/Output).
   - يتم تسجيل هذه البيانات في سجلات الاستخدام (`ai_usage_logs`) لحساب التكلفة المالية الدقيقة لكل عملية.

5. **عرض النتائج (Results Display)**:
   - تظهر النتائج في لوحة التحكم (Dashboard).
   - يمكن للمستخدمين ترتيب المرشحين حسب النسبة المئوية للتوافق.

## 3. التقنيات المستخدمة (Technology Stack)

تم بناء النظام باستخدام مجموعة من التقنيات الحديثة لضمان السرعة والأداء العالي:

### الواجهة الأمامية (Frontend):
- **Next.js 14**: إطار العمل الرئيسي (React Framework) باستخدام App Router.
- **TypeScript**: لضمان جودة الكود وتقليل الأخطاء البرمجية.
- **Tailwind CSS**: لتصميم الواجهات بشكل عصري وسريع الاستجابة.
- **Headless UI & Lucide React**: لمكونات الواجهة والأيقونات.
- **Sonner**: لعرض التنبيهات (Toast Notifications).
- **Recharts**: لعرض الرسوم البيانية في لوحة تتبع التكاليف.

### الواجهة الخلفية وقواعد البيانات (Backend & Database):
- **Firebase Firestore**: قاعدة بيانات NoSQL لتخزين بيانات المرشحين، التقييمات، وسجلات الاستخدام.
- **Firebase Storage**: لتخزين ملفات السير الذاتية (PDFs).
- **Firebase Authentication**: (ضمنيًا) لإدارة المستخدمين.

### الذكاء الاصطناعي (Artificial Intelligence):
- **Google Generative AI (Gemini)**: النموذج المستخدم لتحليل النصوص وتقييم السير الذاتية.

### معالجة الملفات:
- **PDF.js (`pdfjs-dist`)**: لقراءة وتحليل ملفات الـ PDF داخل المتصفح أو الخادم.

## 4. الميزات الرئيسية (Key Features)

1. **التقييم الآلي (Auto-Scoring)**: تحليل فوري للسيرة الذاتية ومقارنتها بمتطلبات الوظيفة.
2. **تتبع تكاليف الذكاء الاصطناعي (AI Cost Tracker)**: لوحة تحكم خاصة للمدير المالي (CFO) لمراقبة الإنفاق على نماذج الذكاء الاصطناعي.
3. **البحث والفرز**: إمكانية البحث عن المرشحين وترتيبهم حسب الكفاءة (Score).
4. **واجهة "Scanner" مبسطة**: إزالة جميع تعقيدات إدارة الحالات والتركيز على النتائج.

## 5. هيكلية المجلدات الرئيسية (Key Directories)

- `app/`: صفحات التطبيق ومسارات التوجيه (Next.js App Router).
- `src/components/`: مكونات واجهة المستخدم (مثل الجداول، البطاقات).
- `src/lib/`: المكتبات المساعدة (مثل `firebase.ts`, `scoreEngine.ts`).
- `src/services/`: خدمات الاتصال بالذكاء الاصطناعي وقواعد البيانات (`aiMatcher.ts`, `usageService.ts`).

---
*تم إنشاء هذا الملف بناءً على طلب المستخدم لتوثيق حالة النظام الحالية.*
